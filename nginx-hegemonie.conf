server {
	listen 80;
	listen [::]:80;

	server_name ~^(www\.)?hegemonie\.be$;
	access_log /var/log/nginx/hegemonie-www.access;
	error_log /var/log/nginx/hegemonie-www.error error;

	root /var/www/hegemonie;

	return 301 https://www.hegemonie.be$request_uri;
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;

	server_name hegemonie.be;
	access_log /var/log/nginx/hegemonie-www.access;
	error_log /var/log/nginx/hegemonie-www.error error;

	ssl on;
    ssl_certificate /etc/letsencrypt/live/hegemonie.be/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/hegemonie.be/privkey.pem; # managed by Certbot

	location = /static/favicon-apple.png { return 301 https://www.hegemonie.be/static/favicon.png; }
	location = /favicon.ico              { return 301 https://www.hegemonie.be/static/favicon.ico; }
	location = /.env                     { return 301 https://www.hegemonie.be/index.html; }
	location ~* /wp-                     { return 301 https://www.hegemonie.be/index.html; }
	location ~* /phpMyAdmin              { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/forum                  { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/admin                  { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/bbs                    { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/vendor                 { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/wordpress              { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/asset                  { return 301 https://www.hegemonie.be/index.html; }

	return 301 https://www.hegemonie.be$request_uri;

}

server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;

	server_name www.hegemonie.be;
	access_log /var/log/nginx/hegemonie-www.access;
	error_log /var/log/nginx/hegemonie-www.error error;

	ssl on;
    ssl_certificate /etc/letsencrypt/live/hegemonie.be/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/hegemonie.be/privkey.pem; # managed by Certbot

	root /var/www/hegemonie;
	index index.html;

	location = /static/favicon-apple.png { return 301 https://www.hegemonie.be/static/favicon.png; }
	location = /favicon.ico              { return 301 https://www.hegemonie.be/static/favicon.ico; }
	location = /.env                     { return 301 https://www.hegemonie.be/index.html; }
	location ~* /wp-                     { return 301 https://www.hegemonie.be/index.html; }
	location ~* /phpMyAdmin              { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/forum                  { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/admin                  { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/bbs                    { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/vendor                 { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/wordpress              { return 301 https://www.hegemonie.be/index.html; }
	location ~* ^/asset                  { return 301 https://www.hegemonie.be/index.html; }

	location ~* ^/static/img/ {
		autoindex on;
		expires 1d;
		add_header Pragma public;
		add_header Cache-Control "public, max-age=86400";
	}

	location / {
		try_files $uri $uri/ =404;
	}
}

server {
	listen 80;
	listen [::]:80;

	server_name app.hegemonie.be;
	access_log /var/log/nginx/hegemonie-app.access;
	error_log /var/log/nginx/hegemonie-app.error error;

	root /var/www/hegemonie;

	return 301 https://app.hegemonie.be$request_uri;
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;

	server_name app.hegemonie.be;
	access_log /var/log/nginx/hegemonie-app.access;
	error_log /var/log/nginx/hegemonie-app.error error;

	ssl on;
    ssl_certificate /etc/letsencrypt/live/hegemonie.be/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/hegemonie.be/privkey.pem; # managed by Certbot

	root /var/www/hegemonie;

	location / {
		proxy_pass http://127.0.0.1:8080;
	}

}
